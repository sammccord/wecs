!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).wecs={})}(this,function(e){e.default=class{constructor(e){void 0===e&&(e={}),this.config={},this._systems=[],this._entities=[],this._queries={},this.config=e}makeQueryKey(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.map(e=>e.name).sort().join("-")}queryWithKey(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];return this._queries[e]?this._queries[e].entities:this._entities.filter(e=>i.every(t=>!!e[t.name]))}register(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];var n=this.makeQueryKey(...i);this._systems.push([e,n]),this._queries[n]={components:i,entities:[],callbacks:[]}}query(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s=this.makeQueryKey(...t);return this.queryWithKey(s,...t)}subscribe(e,t,i){void 0===i&&(i=!1);var s=this.makeQueryKey(...e),n=this.queryWithKey(s,...e);return this._queries[s]?this._queries[s].callbacks.push(t):this._queries[s]={components:e,entities:n,callbacks:[t]},i&&t(n),()=>{this._queries[s]&&this._queries[s].callbacks.splice(this._queries[s].callbacks.indexOf(t),1)}}unsubscribe(e,t){var i=this.makeQueryKey(...e);this._queries[i]&&this._queries[i].callbacks.splice(this._queries[i].callbacks.indexOf(t),1)}createEntity(){for(var e={},t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return i.forEach(t=>{var[i,...s]=t;e[i.name]=new i(...s)}),this._entities.push(e),Object.values(this._queries).forEach(t=>{t.components.every(t=>!!e[t.name])&&t.entities.push(e),t.callbacks.forEach(e=>e(t.entities))}),e}addComponent(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];~i.length&&(i.forEach(t=>{var[i,...s]=t;e[i.name]=new i(...s)}),Object.values(this._queries).forEach(t=>{t.entities.includes(e)||t.components.every(t=>!!e[t.name])&&(t.entities.push(e),t.callbacks.forEach(e=>e(t.entities)))}))}updateComponent(e,t,i){e[t.name]=i(e[t.name])||e[t.name],Object.values(this._queries).forEach(t=>{t.entities.includes(e)&&t.callbacks.forEach(e=>e(t.entities))})}removeComponent(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];~i.length&&(i.forEach(t=>{delete e[t.name]}),Object.values(this._queries).forEach(t=>{t.entities.includes(e)&&(t.components.every(t=>!!e[t.name])||(t.entities.splice(t.entities.indexOf(e),1),t.callbacks.forEach(e=>e(t.entities))))}),~Object.keys(e).length||this._entities.splice(this._entities.indexOf(e),1))}async run(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(this.config.onBefore&&await this.config.onBefore(...t),this.config.parallel)this._systems.forEach(e=>{var[i,s]=e;t?i(...t,this._queries[s].entities):i(this._queries[s].entities)});else for(var[s,n]of this._systems)t?await s(...t,this._queries[n].entities):await s(this._queries[n].entities);this.config.onAfter&&await this.config.onAfter(...t)}},e.getComponent=function(e,t){return e[t.name]},e.hasComponent=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];return i.every(t=>!!e[t.name])}});
//# sourceMappingURL=index.umd.js.map
